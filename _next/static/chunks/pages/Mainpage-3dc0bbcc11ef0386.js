(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[708],{1351:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Mainpage",function(){return r(3965)}])},3965:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var n=r(5893),i=r(7294),s=r(2237),a=e=>{let{lineProps:t,draggable:r}=e,a=i.useRef();return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(i.Fragment,{children:(0,n.jsx)(s.x1,{id:t.id,points:t.points,tension:.5,lineCap:"round",lineJoin:"round",globalCompositeOperation:"eraser"===t.tool?"destination-out":"source-over",strokeScaleEnabled:!1,draggable:r,ref:a,scaleX:t.scaleX?1:t.scaleX,scaleY:t.scaleY?1:t.scaleY,...t,onDragEnd:e=>{t.x=e.target.x(),t.y=e.target.y()},onTransformEnd:e=>{let r=a.current;t.x=r.x(),t.y=r.y(),t.scaleX=r.scaleX(),t.scaleY=r.scaleY(),t.rotation=r.rotation()}})})})},l=e=>{let{shapeProps:t,draggable:r}=e,a=i.useRef();return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(i.Fragment,{children:(0,n.jsx)(s.UL,{ref:a,width:t.width,height:t.height,strokeScaleEnabled:!1,...t,draggable:r,onDragEnd:e=>{t.x=e.target.x(),t.y=e.target.y()},onTransformEnd:e=>{let r=a.current;t.x=e.target.x(),t.y=e.target.y(),t.scaleX=r.scaleX(),t.scaleY=r.scaleY(),t.rotation=r.rotation()}})})})},o=r(4420),c=r.n(o),d=e=>{let{imageProps:t,draggable:r}=e,a=i.useRef(),[l]=c()(t.src);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(s.Ee,{alt:"image",image:l,ref:a,...t,draggable:r,onDragEnd:e=>{t.x=e.target.x(),t.y=e.target.y()},onTransformEnd:e=>{let r=a.current;t.x=r.x(),t.y=r.y(),t.scaleX=r.scaleX(),t.scaleY=r.scaleY(),t.rotation=r.rotation()}},t.key)})},u=e=>{let{key:t,textProps:r,isSelected:a,onSelect:l,onChange:o,onDragStart:c,draggable:d,handleDoubleClick:u}=e,h=i.useRef(),g=i.useRef(),[x,f]=i.useState(),[y,v]=i.useState();return i.useEffect(()=>{a&&(g.current.nodes([h.current]),g.current.getLayer().batchDraw())},[a]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.xv,{text:r.content,x:r.x,y:r.y,fontSize:r.fontSize,onDblClick:u,onClick:l,onTap:l,ref:h,draggable:d,onDragStart:c,onDragEnd:e=>{o({...r,x:e.target.x(),y:e.target.y()})},onTransformEnd:e=>{}},r.id),a&&(0,n.jsx)(s.$T,{ref:g,flipEnabled:!1,boundBoxFunc:(e,t)=>5>Math.abs(t.width)||5>Math.abs(t.height)?e:t})]})},h=e=>{let{shapeProps:t,draggable:r}=e,a=i.useRef();return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(i.Fragment,{children:(0,n.jsx)(s.Pj,{ref:a,...t,strokeScaleEnabled:!1,draggable:r,onDragEnd:e=>{t.x=e.target.x(),t.y=e.target.y()},onTransformEnd:e=>{let r=a.current;t.x=r.x(),t.y=r.y(),t.scaleX=r.scaleX(),t.scaleY=r.scaleY(),t.radius={x:Math.max(5,r.radius().x),y:Math.max(5,Math.max(5,r.radius().y))},t.rotation=r.rotation()}})})})};let g=e=>{let{tool:t,value:r,onClick:i,activeColor:s="red",inactiveColor:a="black"}=e;return(0,n.jsx)("button",{type:"button",onClick:i,style:{color:t===r?s:a,cursor:"pointer"},children:r})},x=["pen",,"line","rectangle","circle","text","cursor","hand"],f={id:"rect",tool:"rectangle",x:0,y:0,width:0,height:0,stroke:"black",strokeWidth:5,visible:!1},y={id:"circle",tool:"circle",x:0,y:0,radius:{x:0,y:0},stroke:"black",strokeWidth:5,visible:!1},v={id:"rect",tool:"rectangle",x:0,y:0,width:0,height:0,stroke:"black",strokeWidth:0,visible:!1,fill:"rgba(0,0,255,0.5)"};var b=()=>{let e=(0,i.useRef)(null),[t,r]=(0,i.useState)(1),[o,c]=(0,i.useState)([]),[b,p]=(0,i.useState)(0),[k,j]=(0,i.useState)({x:0,y:0}),[w,m]=(0,i.useState)(0),[S,E]=(0,i.useState)(0),[C,N]=(0,i.useState)("pen"),O=(0,i.useRef)(!1),D=(0,i.useRef)(),[R,T]=(0,i.useState)(),[P,W]=(0,i.useState)([]),[J,M]=(0,i.useState)(f),[X,_]=(0,i.useState)(y),[F,Y]=(0,i.useState)([]),[L,A]=(0,i.useState)(0),[I,U]=(0,i.useState)(),B=(0,i.useRef)(null),z=(0,i.useRef)(null),[H,$]=(0,i.useState)(v),[q,G]=(0,i.useState)(!1),[K,Q]=(0,i.useState)(""),[V,Z]=(0,i.useState)(!1),ee=e=>{e.target===e.target.getStage()&&(W([]),U(null))};(0,i.useEffect)(()=>{let t=e.current.getStage(),r=t.attrs.container;r.tabIndex=1,m(window.innerWidth),E(window.innerHeight);let n=e=>{let r=et(t.getPointerPosition());switch(C){case"text":Y([...F,{id:L,content:"Start typing",x:r.x,y:r.y,fontSize:20}]),U(L),A(L+1),W(null);return;case"cursor":if(Q(e.target.id()),P.find(t=>t==e.target.id())||B.current.children.find(t=>t._id==e.target._id)){Z(!0);return}ee(e);let n=JSON.parse(JSON.stringify(H));n.x=r.x,n.y=r.y,n.visible=!0,$(n),G(!0);return;case"pen":case"eraser":O.current=!0;let i={tool:C,points:[r.x,r.y],id:b.toString(),stroke:"black",strokeWidth:5};var s=[...o.slice(0,b),i];c(s),W([b]),el(i.strokeWidth),p(b+1);return;case"line":O.current=!0;let a={tool:C,points:[r.x,r.y],id:b.toString(),strokeWidth:5,stroke:"black"};var s=[...o.slice(0,b),a];c(s),W([b]),el(a.strokeWidth),p(b+1);return;case"rectangle":O.current=!0;let l=JSON.parse(JSON.stringify(J));l.x=r.x,l.y=r.y,l.visible=!0,M(l);return;case"circle":O.current=!0;let d=JSON.parse(JSON.stringify(X));d.x=r.x,d.y=r.y,d.visible=!0,_(d);return}},i=e=>{if(!O.current&&!q)return;let r=et(t.getPointerPosition());if("pen"==C||"eraser"==C){let e=o[o.length-1];e.points=e.points.concat([r.x,r.y]),c([...o.slice(0,-1),e])}else if("line"==C){let e=o[o.length-1];e.points=[...e.points.slice(0,2),r.x,r.y],c([...o.slice(0,-1),e])}else if("rectangle"==C){let e=JSON.parse(JSON.stringify(J));e.width=r.x-e.x,e.height=r.y-e.y,e.visible=!0,M(e)}else if("circle"==C){let e=JSON.parse(JSON.stringify(X));e.radius={x:Math.abs(r.x-e.x),y:Math.abs(r.y-e.y)},e.visible=!0,_(e)}else if("cursor"==C){let e=JSON.parse(JSON.stringify(H));e.width=r.x-e.x,e.height=r.y-e.y,e.visible=!0,$(e)}},s=e=>{if(O.current=!1,"rectangle"==C){let e=JSON.parse(JSON.stringify(J));e.id=b.toString();var r=[...o.slice(0,b),e];c(r),el(e.strokeWidth),W([b]),p(b+1),M(f)}else if("circle"==C){let e=JSON.parse(JSON.stringify(X));e.id=b.toString();var r=[...o.slice(0,b),e];c(r),el(e.strokeWidth),W([b]),p(b+1),_(y)}else if("cursor"==C){if(V){Z(!1);return}$(v),G(!1),e.evt.preventDefault();var n=[...t.find("Rect").filter(e=>void 0!=e.attrs.id),...t.find("Line"),...t.find("Image"),...t.find("Ellipse")],i=z.current.getClientRect(),s=n.filter(e=>{let t=e.getClientRect();return t.x>=i.x&&t.y>=i.y&&t.x+t.width<=i.x+i.width&&t.y+t.height<=i.y+i.height});if(0==s.length&&""!=K&&K==e.target.id()){e.target.moveToTop(),B.current.nodes([e.target]),B.current.moveToTop(),W([K]),Q("");return}s.forEach(e=>e.moveToTop()),B.current.nodes(s),B.current.moveToTop(),W(s.map(e=>e.id())),Q("")}},a=e=>{if("cursor"!=C&&"text"!=C)return;let t=e.key;if(void 0!=F.find(e=>e.id==I)&&["Backspace","Delete","ArrowLeft","ArrowRight","Enter",...Array.from("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ,.?!")].includes(t)){var r=[...F];"Backspace"===t?r[I].content=r[I].content.slice(0,-1):"Delete"===t?r=1==r.length?[]:r.filter(e=>e.id!=I):"Enter"===t?setIsTyping(!1):r[I].content=r[I].content+t,Y(r)}};return t.on("mousedown touchstart",n),t.on("mousemove touchmove",i),t.on("mouseup touchend",s),r.addEventListener("keydown",a),()=>{t.off("mousedown touchstart",n),t.off("mousemove touchmove",i),t.off("mouseup touchend",s),r.removeEventListener("keydown",a)}},[C,o,b,F,I,J,t,X,L,P,q,H,K,V,B]);let et=e=>({x:(e.x-k.x)/t,y:(e.y-k.y)/t}),er=e=>{switch(e.tool){case"pen":case"eraser":case"line":return(0,n.jsx)(a,{lineProps:e,draggable:"cursor"==C&&P.find(t=>t==e.id)});case"image":return(0,n.jsx)(d,{imageProps:e,draggable:"cursor"==C&&P.find(t=>t==e.id)});case"rectangle":return(0,n.jsx)(l,{shapeProps:e,draggable:"cursor"==C&&P.find(t=>t==e.id)});case"circle":return(0,n.jsx)(h,{shapeProps:e,draggable:"cursor"==C&&P.find(t=>t==e.id)});default:return(0,n.jsx)(n.Fragment,{})}},en=(e,t)=>{var r=document.createElement("a");r.download=t,r.href=e,document.body.appendChild(r),r.click(),document.body.removeChild(r)},[ei,es]=(0,i.useState)(""),[ea,el]=(0,i.useState)(1),eo=e=>{let t=e.target.getAttribute("value");es(t);let r=o.slice();var n=P.map(e=>o.findIndex(t=>t.id==e));0!=n.length&&(n.forEach(e=>{r[e].stroke=t}),c(r))};return(0,n.jsxs)("div",{onDrop:t=>{t.preventDefault(),e.current.setPointersPositions(t);let r=et(e.current.getPointerPosition(t));var n={id:b.toString(),tool:"image",key:b,type:"image",...r,src:D.current};c([...o.slice(0,b),n]),p(b+1)},onDragOver:e=>e.preventDefault(),children:[(0,n.jsxs)("div",{style:{display:"flex"},children:[(0,n.jsxs)("div",{style:{width:"40vw",border:"1px solid black",marginRight:"2vw"},children:[x.map(e=>(0,n.jsx)(g,{tool:C,value:e,label:e,onClick:()=>{W([]),N(e),U(null)}},e)),(0,n.jsx)("button",{onClick:()=>{b>0&&(W([]),B.current.nodes([]),p(b-1))},children:"undo"}),(0,n.jsx)("button",{onClick:()=>{b<o.length&&(W([]),B.current.nodes([]),p(b+1))},children:"redo"}),(0,n.jsx)("button",{onClick:()=>{en(e.current.getStage().toDataURL(),"stage.png")},children:"Save as image"}),(0,n.jsx)("br",{}),(0,n.jsxs)("span",{children:["items: ",o.length," "]}),(0,n.jsxs)("span",{children:["historyPointer: ",b]}),(0,n.jsx)("br",{}),(0,n.jsx)("button",{onClick:()=>{Math.floor(10*t)>1&&r(t-.1)},children:"-10%"}),(0,n.jsxs)("span",{children:[Math.floor(100*t),"%"]}),(0,n.jsx)("button",{onClick:()=>{20>Math.floor(10*t)&&r(t+.1)},children:"+10%"}),(0,n.jsx)("img",{width:100,height:100,src:R,draggable:"true",onDragStart:e=>{D.current=e.target.src}}),(0,n.jsx)("input",{type:"file",onChange:e=>{let t=e.target.files[0],r=new FileReader;r.onload=e=>{T(e.target.result)},t&&r.readAsDataURL(t)}})]}),(0,n.jsxs)("div",{style:{width:"40vw",border:"1px solid black",marginRight:"2vw"},children:[(0,n.jsx)("span",{children:"stroke color: "}),(0,n.jsx)("button",{onClick:eo,value:"black",children:(0,n.jsx)("div",{style:{width:"1vw",height:"1vw",backgroundColor:"black"},value:"black"})}),(0,n.jsx)("button",{onClick:eo,value:"red",children:(0,n.jsx)("div",{style:{width:"1vw",height:"1vw",backgroundColor:"red"},value:"red"})}),(0,n.jsx)("button",{onClick:eo,value:"blue",children:(0,n.jsx)("div",{style:{width:"1vw",height:"1vw",backgroundColor:"blue"},value:"blue"})}),(0,n.jsx)("button",{onClick:eo,value:"orange",children:(0,n.jsx)("div",{style:{width:"1vw",height:"1vw",backgroundColor:"orange"},value:"orange"})}),(0,n.jsx)("button",{onClick:eo,value:"green",children:(0,n.jsx)("div",{style:{width:"1vw",height:"1vw",backgroundColor:"green"},value:"green"})}),(0,n.jsx)("br",{}),(0,n.jsx)("span",{children:"stroke width: "}),(0,n.jsxs)("select",{onChange:e=>{let t=e.target.value;el(t);let r=o.slice();var n=P.map(e=>o.findIndex(t=>t.id==e));0!=n.length&&(n.forEach(e=>{r[e].strokeWidth=Number(t)}),c(r))},value:ea,children:[(0,n.jsx)("option",{value:1,children:"1"}),(0,n.jsx)("option",{value:2,children:"2"}),(0,n.jsx)("option",{value:3,children:"3"}),(0,n.jsx)("option",{value:4,children:"4"}),(0,n.jsx)("option",{value:5,children:"5"})]})]})]}),(0,n.jsx)(s.Hf,{ref:e,x:k.x,y:k.y,width:w,height:S,scale:{x:t,y:t},style:{border:"1px solid black"},draggable:"hand"==C,onDragEnd:e=>{j(e.currentTarget.position())},children:(0,n.jsxs)(s.mh,{children:[F.map(e=>(0,n.jsx)(u,{textProps:e,isSelected:e.id===I,onSelect:()=>{"cursor"==C&&(U(e.id),W([]))},onChange:e=>{let t=F.slice();t[I]=e,Y(t)},onDragStart:()=>{"cursor"==C&&(U(e.id),W([]))},draggable:"cursor"==C},e.id)),(0,n.jsx)("textarea",{}),o.slice(0,b).map(e=>er(e)),(0,n.jsx)(s.UL,{x:J.x,y:J.y,width:J.width,height:J.height,stroke:J.stroke,strokeWidth:J.strokeWidth,visible:J.visible}),(0,n.jsx)(s.Pj,{x:X.x,y:X.y,radius:X.radius,width:100,height:10,stroke:X.stroke,strokeWidth:X.strokeWidth,visible:X.visible}),(0,n.jsx)(s.UL,{ref:z,x:H.x,y:H.y,width:H.width,height:H.height,stroke:H.stroke,strokeWidth:H.strokeWidth,visible:H.visible,fill:H.fill}),(0,n.jsx)(s.$T,{ref:B,flipEnabled:!0,shouldOverdrawWholeArea:!0,boundBoxFunc:(e,t)=>5>Math.abs(t.width)||5>Math.abs(t.height)?e:t})]})})]})},p=()=>(0,n.jsx)("div",{children:(0,n.jsx)(b,{})})}},function(e){e.O(0,[289,888,774,179],function(){return e(e.s=1351)}),_N_E=e.O()}]);